<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>首页 - Grdsome 博客</title><meta name="gridsome:hash" content="87002c5fa157b6e786d19711f6bffff4b0d9c799"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.23"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.9bb7ffafafc09ac851d81afb65b8ef59.png"><link rel="preload" href="/assets/css/8.styles.8d7e1c32.css" as="style"><link rel="preload" href="/assets/js/app.aa04e74c.js" as="script"><link rel="preload" href="/assets/js/page--src-templates-blog-vue.a3da5a2e.js" as="script"><link rel="prefetch" href="/assets/js/page--node-modules-gridsome-app-pages-404-vue.0ddd1ab5.js"><link rel="prefetch" href="/assets/js/page--src-templates-blog-list-vue.8a24ccb4.js"><link rel="prefetch" href="/assets/js/page--src-templates-new-vue.8b4559ca.js"><link rel="prefetch" href="/assets/js/page--src-templates-project-list-vue.ba063837.js"><link rel="prefetch" href="/assets/js/page--src-templates-project-vue.7a542983.js"><link rel="prefetch" href="/assets/js/page--src-templates-social-vue.3a209dab.js"><link rel="stylesheet" href="/assets/css/8.styles.8d7e1c32.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <div id="app" data-server-rendered="true" class="layout"><header class="header" style="background-image:;"><div class="cover"></div><div class="user"><div class="el-image"><div class="el-image__placeholder"></div><!----></div><div class="name"></div><div class="description"></div></div></header><content class="content"><section class="el-container box is-vertical"><header class="el-header header" style="height:60px;"><div class="el-row"><div class="el-col el-col-24"><a><button type="button" class="el-button el-button--default"><!----><i class="el-icon-edit"></i><span>修改文章</span></button></a></div></div></header><section class="el-container cnt"><aside class="el-aside aside" style="width:200px;"><ul role="menubar" class="menu el-menu" style="background-color:;"><a href="/new?username=undefined"><li role="menuitem" tabindex="-1" class="el-menu-item" style="padding-left:20px;color:;background-color:;"><i class="el-icon-menu"></i><span>最新动态</span></li></a><a href="/blog-list"><li role="menuitem" tabindex="-1" class="el-menu-item" style="padding-left:20px;color:;background-color:;"><i class="el-icon-notebook-2"></i><span>博客列表</span></li></a><a href="/social"><li role="menuitem" tabindex="-1" class="el-menu-item" style="padding-left:20px;color:;background-color:;"><i class="el-icon-bangzhu"></i><span>关注账号</span></li></a><a href="/project-list"><li role="menuitem" tabindex="-1" class="el-menu-item" style="padding-left:20px;color:;background-color:;"><i class="el-icon-orange"></i><span>我的项目</span></li></a></ul></aside><main class="el-main main"><div class="article"><div class="markdown-title"><div class="title">
            前端工程化5：Gulp最基本配置，10分钟看完就会
        </div><div class="el-divider el-divider--horizontal"><!----></div><div class="time"><div class="updated">更新时间：2021/7/12</div><div class="published">发布时间：2021/7/12</div></div></div><div class="markdown-cnt"><!----><div class="cnt"><!----><div class="markdown-here-wrapper"><h2>Gulp的基本使用</h2>
<h4>安装</h4>
<pre><code class="language-js">&gt; npm install gulp -g
</code></pre>
<p>gulp的配置文件：gulpfile.js
gulp4.0以后不再推荐使用 gulp.task() ，而是推荐使用 exports 的方式定义任务：</p>
<pre><code class="language-js"><span class="hljs-built_in">exports</span>.<span class="hljs-property">foo</span> = <span class="hljs-function"><span class="hljs-params">done</span> =&gt;</span>{

  <span class="hljs-title function_">done</span>() <span class="hljs-comment">//标记任务完成</span>
}
</code></pre>
<h4>组合配置</h4>
<pre><code class="language-js"><span class="hljs-keyword">const</span> { series, parallel } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;gulp&#x27;</span>)

<span class="hljs-keyword">const</span> <span class="hljs-title function_">task1</span> = done =&gt; {
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;task1 working~&#x27;</span>)
    <span class="hljs-title function_">done</span>()
  }, <span class="hljs-number">1000</span>)
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">task2</span> = done =&gt; {
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;task2 working~&#x27;</span>)
    <span class="hljs-title function_">done</span>()
  }, <span class="hljs-number">1000</span>)  
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">task3</span> = done =&gt; {
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;task3 working~&#x27;</span>)
    <span class="hljs-title function_">done</span>()
  }, <span class="hljs-number">1000</span>)  
}

<span class="hljs-comment">// 让多个任务按照顺序依次执行</span>
<span class="hljs-built_in">exports</span>.<span class="hljs-property">foo</span> = <span class="hljs-title function_">series</span>(task1, task2, task3)

<span class="hljs-comment">// 让多个任务同时执行</span>
<span class="hljs-built_in">exports</span>.<span class="hljs-property">bar</span> = <span class="hljs-title function_">parallel</span>(task1, task2, task3)
</code></pre>
<h4>异步任务</h4>
<pre><code class="language-js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)

<span class="hljs-built_in">exports</span>.<span class="hljs-property">callback</span> = <span class="hljs-function"><span class="hljs-params">done</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;callback task&#x27;</span>)
  <span class="hljs-title function_">done</span>()
}

<span class="hljs-built_in">exports</span>.<span class="hljs-property">callback_error</span> = <span class="hljs-function"><span class="hljs-params">done</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;callback task&#x27;</span>)
  <span class="hljs-title function_">done</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;task failed&#x27;</span>))
}

<span class="hljs-built_in">exports</span>.<span class="hljs-property">promise</span> = <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;promise task&#x27;</span>)
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>()
}

<span class="hljs-built_in">exports</span>.<span class="hljs-property">promise_error</span> = <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;promise task&#x27;</span>)
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;task failed&#x27;</span>))
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">timeout</span> = time =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(resolve, time)
  })
}

<span class="hljs-comment">// Nodejs版本在8以上可以使用async、await</span>
<span class="hljs-built_in">exports</span>.<span class="hljs-property">async</span> = <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">timeout</span>(<span class="hljs-number">1000</span>)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;async task&#x27;</span>)
}

<span class="hljs-comment">// 最常用的一种，读写文件</span>
<span class="hljs-built_in">exports</span>.<span class="hljs-property">stream</span> = <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> read = fs.<span class="hljs-title function_">createReadStream</span>(<span class="hljs-string">&#x27;yarn.lock&#x27;</span>)
  <span class="hljs-keyword">const</span> write = fs.<span class="hljs-title function_">createWriteStream</span>(<span class="hljs-string">&#x27;a.txt&#x27;</span>)
  read.<span class="hljs-title function_">pipe</span>(write) <span class="hljs-comment">// 导入文件流</span>
  <span class="hljs-keyword">return</span> read <span class="hljs-comment">// 结束任务</span>
}

<span class="hljs-comment">// exports.stream = done =&gt; {</span>
<span class="hljs-comment">//   const read = fs.createReadStream(&#x27;yarn.lock&#x27;)</span>
<span class="hljs-comment">//   const write = fs.createWriteStream(&#x27;a.txt&#x27;)</span>
<span class="hljs-comment">//   read.pipe(write)</span>
<span class="hljs-comment">//   read.on(&#x27;end&#x27;, () =&gt; { // 结束任务</span>
<span class="hljs-comment">//     done()</span>
<span class="hljs-comment">//   })</span>
<span class="hljs-comment">// }</span>

</code></pre>
<h4>构建过程核心工作原理</h4>
<p>输入 =&gt; 加工 =&gt; 输出</p>
<pre><code class="language-js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)
<span class="hljs-keyword">const</span> { <span class="hljs-title class_">Transform</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;stream&#x27;</span>)

<span class="hljs-built_in">exports</span>.<span class="hljs-property">default</span> = <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// 文件读取流</span>
  <span class="hljs-keyword">const</span> readStream = fs.<span class="hljs-title function_">createReadStream</span>(<span class="hljs-string">&#x27;normalize.css&#x27;</span>)

  <span class="hljs-comment">// 文件写入流</span>
  <span class="hljs-keyword">const</span> writeStream = fs.<span class="hljs-title function_">createWriteStream</span>(<span class="hljs-string">&#x27;normalize.min.css&#x27;</span>)

  <span class="hljs-comment">// 文件转换流</span>
  <span class="hljs-keyword">const</span> transformStream = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transform</span>({
    <span class="hljs-comment">// 核心转换过程</span>
    <span class="hljs-attr">transform</span>: <span class="hljs-function">(<span class="hljs-params">chunk, encoding, callback</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> input = chunk.<span class="hljs-title function_">toString</span>()
      <span class="hljs-keyword">const</span> output = input.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\s+/g</span>, <span class="hljs-string">&#x27;&#x27;</span>).<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\/\*.+?\*\//g</span>, <span class="hljs-string">&#x27;&#x27;</span>)
      <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, output)
    }
  })

  <span class="hljs-keyword">return</span> readStream
    .<span class="hljs-title function_">pipe</span>(transformStream) <span class="hljs-comment">// 转换</span>
    .<span class="hljs-title function_">pipe</span>(writeStream) <span class="hljs-comment">// 写入</span>
}

</code></pre>
<h4>文件操作API</h4>
<pre><code class="language-js"><span class="hljs-keyword">const</span> { src, dest } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;gulp&#x27;</span>)
<span class="hljs-keyword">const</span> cleanCSS = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;gulp-clean-css&#x27;</span>)
<span class="hljs-keyword">const</span> rename = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;gulp-rename&#x27;</span>)

<span class="hljs-built_in">exports</span>.<span class="hljs-property">default</span> = <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">src</span>(<span class="hljs-string">&#x27;src/*.css&#x27;</span>)
    .<span class="hljs-title function_">pipe</span>(<span class="hljs-title function_">cleanCSS</span>()) <span class="hljs-comment">// 压缩css代码插件</span>
    .<span class="hljs-title function_">pipe</span>(<span class="hljs-title function_">rename</span>({ <span class="hljs-attr">extname</span>: <span class="hljs-string">&#x27;.min.css&#x27;</span> })) <span class="hljs-comment">// 重命名文件插件</span>
    .<span class="hljs-title function_">pipe</span>(<span class="hljs-title function_">dest</span>(<span class="hljs-string">&#x27;dist&#x27;</span>))
}

</code></pre>
<h2>Gulp基础配置</h2>
<h4>准备工作</h4>
<ul>
<li>安装gulp工具：npm install gulp -g</li>
<li>创建gulp配置：在项目根目录下新建文件gulpfile.js，用于写gulp的配置文件；</li>
</ul>
<h4>Task：清空文件</h4>
<ul>
<li>功能：清空构件生产的所有文件</li>
<li>依赖：del</li>
</ul>
<pre><code class="language-js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">clean</span> = (<span class="hljs-params"></span>) =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">del</span>([<span class="hljs-string">&#x27;dist&#x27;</span>,<span class="hljs-string">&#x27;temp&#x27;</span>])
}
</code></pre>
<h4>Task：css文件处理，sass文件转换</h4>
<ul>
<li>功能：将sass文件转换成css文件写入指定目录</li>
<li>依赖：gulp-sass</li>
</ul>
<pre><code class="language-js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">style</span> = (<span class="hljs-params"></span>) =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">src</span>(<span class="hljs-string">&#x27;src/assets/styles/*.scss&#x27;</span>,{ <span class="hljs-attr">base</span>: <span class="hljs-string">&#x27;src&#x27;</span>}) <span class="hljs-comment">// base指定基础目录，转换后dist目录才会和src保持一样的结构</span>
        .<span class="hljs-title function_">pipe</span>(plugins.<span class="hljs-title function_">sass</span>({ <span class="hljs-attr">outputStyle</span>: <span class="hljs-string">&#x27;expanded&#x27;</span>})) <span class="hljs-comment">// { outputStyle: &#x27;expanded&#x27;} 参数可以指定结束括号格式化    </span>
        .<span class="hljs-title function_">pipe</span>(<span class="hljs-title function_">dest</span>(<span class="hljs-string">&#x27;temp&#x27;</span>))
}
</code></pre>
<h4>Task：js文件处理，编译es6+为es5</h4>
<ul>
<li>功能：使用babel插件将js文件里的es6+代码转换为es5</li>
<li>依赖：</li>
</ul>
<blockquote>
<p>1、gulp-babel =&gt; babel工具：转换平台，不作具体的工作
2、@babel/core =&gt; babel核心转换模块：完成语言转换工作
3、@babel/preset-env =&gt; babel的转换插件：指定babel对应的转换内容；比如env包含es6+全部新特性，将其转换到es5</p>
</blockquote>
<pre><code class="language-js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">script</span> = (<span class="hljs-params"></span>) =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">src</span>(<span class="hljs-string">&#x27;src/assets/scripts/*.js&#x27;</span>,{ <span class="hljs-attr">base</span>: <span class="hljs-string">&#x27;src&#x27;</span>})
        .<span class="hljs-title function_">pipe</span>(plugins.<span class="hljs-title function_">babel</span>({ 
            <span class="hljs-attr">presets</span>: [<span class="hljs-string">&#x27;@babel/preset-env&#x27;</span>] <span class="hljs-comment">// 编译es6，必须传递参数preset-env，否则转换失效(babel配置可以单独放到.babelrc文件)</span>
        }))
        .<span class="hljs-title function_">pipe</span>(<span class="hljs-title function_">dest</span>(<span class="hljs-string">&#x27;temp&#x27;</span>))
}
</code></pre>
<h4>Task：html文件的转换，处理swig模板</h4>
<ul>
<li>功能：将指定的swig模板转换为html文件，注意：</li>
</ul>
<blockquote>
<p>1、gulp配置的时候可以将数据以对象的形式传递数据给模板引擎；通常将数据定义在文件中：pages.config.js
2、swig模板的缓存配置可以关闭，防止浏览器在热更新时没有实时刷新</p>
</blockquote>
<ul>
<li>依赖：gulp-swig</li>
</ul>
<pre><code class="language-js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">page</span> = (<span class="hljs-params"></span>) =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">src</span>(<span class="hljs-string">&#x27;src/**/*.html&#x27;</span>,{ <span class="hljs-attr">base</span>: <span class="hljs-string">&#x27;src&#x27;</span>}) <span class="hljs-comment">// 其中/**/*.html表示在src目录下任意子目录下的匹配</span>
        .<span class="hljs-title function_">pipe</span>(plugins.<span class="hljs-title function_">swig</span>({ <span class="hljs-attr">data</span>: config.<span class="hljs-property">data</span>, <span class="hljs-attr">defaults</span>: { <span class="hljs-attr">cache</span>: <span class="hljs-literal">false</span> } }))   <span class="hljs-comment">//转换模板页，将data数据传递给模板使用，cache：swig缓存设置，否则热更新时可能不立即生效</span>
        .<span class="hljs-title function_">pipe</span>(<span class="hljs-title function_">dest</span>(<span class="hljs-string">&#x27;temp&#x27;</span>))
}
</code></pre>
<h4>Task：图片压缩，减少图片体积</h4>
<ul>
<li>功能：压缩图片体积</li>
<li>依赖：gulp-imagemin</li>
</ul>
<pre><code class="language-js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">image</span> = (<span class="hljs-params"></span>) =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">src</span>(<span class="hljs-string">&#x27;src/assets/images/**&#x27;</span>,{ <span class="hljs-attr">base</span>: <span class="hljs-string">&#x27;src&#x27;</span>})
        .<span class="hljs-title function_">pipe</span>(plugins.<span class="hljs-title function_">imagemin</span>())
        .<span class="hljs-title function_">pipe</span>(<span class="hljs-title function_">dest</span>(<span class="hljs-string">&#x27;dist&#x27;</span>))
}
</code></pre>
<h4>Task：字体文件压缩，减少字体文件体积</h4>
<ul>
<li>功能：压缩字体体积</li>
<li>依赖：gulp-imagemin</li>
</ul>
<pre><code class="language-js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">font</span> = (<span class="hljs-params"></span>) =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">src</span>(<span class="hljs-string">&#x27;src/assets/fonts/**&#x27;</span>, { <span class="hljs-attr">base</span>: <span class="hljs-string">&#x27;src&#x27;</span> })
      .<span class="hljs-title function_">pipe</span>(plugins.<span class="hljs-title function_">imagemin</span>())
      .<span class="hljs-title function_">pipe</span>(<span class="hljs-title function_">dest</span>(<span class="hljs-string">&#x27;dist&#x27;</span>))
}
</code></pre>
<h4>Task：其它文件移动，例如视频</h4>
<ul>
<li>功能：移动其余所有文件到指定目录</li>
<li>依赖：无</li>
</ul>
<pre><code class="language-js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">extra</span> = (<span class="hljs-params"></span>) =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">src</span>(<span class="hljs-string">&#x27;public/**&#x27;</span>, { <span class="hljs-attr">base</span>: <span class="hljs-string">&#x27;public&#x27;</span> })
        .<span class="hljs-title function_">pipe</span>(<span class="hljs-title function_">dest</span>(<span class="hljs-string">&#x27;dist&#x27;</span>))
}
</code></pre>
<h2>Gulp的本地服务/热更新/文件合并与压缩</h2>
<h4>Task：本地Web服务与热更新</h4>
<ul>
<li>功能1：本地Web服务</li>
</ul>
<blockquote>
<p>1、使用插件browser-sync来启动本地Web服务，并支持一些配置（具体参考示例代码）
2、重要配置：根路径baseDir，配置后gulp从指定的路径按顺序查找
3、重要配置：路径查找路由routes，例如：/node_modules映射到node_modules</p>
</blockquote>
<ul>
<li>功能2：浏览器的热更新</li>
</ul>
<blockquote>
<p>在browser-sync插件的配置中使用files: 'temp/**'监视目录下所有文件</p>
</blockquote>
<ul>
<li>功能3：源文件的热更新</li>
</ul>
<blockquote>
<p>1、监视源文件，如果源文件修改后立即重新构建
2、开发模式下：监视的范围不包括图片、字体和其它文件，将他们的访问路径指定为src路径下可提升构建效率</p>
</blockquote>
<ul>
<li>依赖：browser-sync</li>
</ul>
<pre><code class="language-js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">serve</span> = (<span class="hljs-params"></span>) =&gt; {
    <span class="hljs-comment">// 监视src文件，重新构建代码</span>
    <span class="hljs-title function_">watch</span>(<span class="hljs-string">&#x27;src/assets/styles/*.scss&#x27;</span>, style)
    <span class="hljs-title function_">watch</span>(<span class="hljs-string">&#x27;src/assets/scripts/*.js&#x27;</span>, script)
    <span class="hljs-title function_">watch</span>(<span class="hljs-string">&#x27;src/*.html&#x27;</span>, page)

    <span class="hljs-comment">// 图片、字体在开发阶段没有必要重新执行构建任务；所以让gulp从源文件src、public里面查找  </span>
    <span class="hljs-comment">// 图片、字体等文件发生变化后，bs.reload 更新浏览器</span>
    <span class="hljs-title function_">watch</span>([
        <span class="hljs-string">&#x27;src/assets/images/**&#x27;</span>,
        <span class="hljs-string">&#x27;src/assets/fonts/**&#x27;</span>,
        <span class="hljs-string">&#x27;public/**&#x27;</span>
    ], bs.<span class="hljs-property">reload</span>)
    
    <span class="hljs-comment">// 配置web服务器，监视dist</span>
    bs.<span class="hljs-title function_">init</span>({
        <span class="hljs-attr">notify</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 右上角提示</span>
        <span class="hljs-attr">port</span>: <span class="hljs-number">2080</span>, <span class="hljs-comment">// 服务的端口，默认300</span>
        <span class="hljs-comment">// open: false, // 自动打开浏览器</span>
        <span class="hljs-attr">files</span>: <span class="hljs-string">&#x27;temp/**&#x27;</span>, <span class="hljs-comment">// 热更新，dist下的所有文件变化时，同步更新浏览器</span>
        <span class="hljs-attr">server</span>: {
          <span class="hljs-comment">//服务启动时，首先访问dist根目录；查询路径：dist=&gt;src=&gt;public</span>
          <span class="hljs-comment">//因为图片字体等文件没必要热更新重新构建（减少构建时间），所以让gulp从源文件src、public里面查找  </span>
          <span class="hljs-attr">baseDir</span>: [<span class="hljs-string">&#x27;temp&#x27;</span>, <span class="hljs-string">&#x27;src&#x27;</span>, <span class="hljs-string">&#x27;public&#x27;</span>], 
          <span class="hljs-attr">routes</span>: {<span class="hljs-comment">// 路径查找路由</span>
            <span class="hljs-string">&#x27;/node_modules&#x27;</span>: <span class="hljs-string">&#x27;node_modules&#x27;</span> <span class="hljs-comment">//优先级高于baseDir,先查找node_modules目录</span>
          }
        }
    })
}
</code></pre>
<h4>Task：文件合并与压缩混淆</h4>
<ul>
<li>功能1：文件合并</li>
</ul>
<blockquote>
<p>useref插件查询指定路径，然后将对应的文件合并</p>
</blockquote>
<ul>
<li>功能2：文件压缩</li>
</ul>
<blockquote>
<p>1、压缩js
2、压缩css
3、压缩html</p>
</blockquote>
<ul>
<li>依赖：</li>
</ul>
<blockquote>
<p>1、gulp-useref =&gt; 查询路径，合并文件
2、gulp-if =&gt; 判断条件插件
3、gulp-uglify =&gt; 压缩js
4、gulp-clean-css=&gt; 压缩css
5、gulp-htmlmin =&gt; 压缩html</p>
</blockquote>
<pre><code class="language-js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">useref</span> = (<span class="hljs-params"></span>) =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">src</span>(<span class="hljs-string">&#x27;temp/*.html&#x27;</span>, { <span class="hljs-attr">base</span>: <span class="hljs-string">&#x27;temp&#x27;</span> })
        .<span class="hljs-title function_">pipe</span>(plugins.<span class="hljs-title function_">useref</span>({ <span class="hljs-attr">searchPath</span>: [<span class="hljs-string">&#x27;temp&#x27;</span>, <span class="hljs-string">&#x27;.&#x27;</span>] })) <span class="hljs-comment">//查询路径：dist、.根目录下（node_modules） </span>
        <span class="hljs-comment">// html js css压缩代码</span>
        .<span class="hljs-title function_">pipe</span>(plugins.<span class="hljs-title function_">if</span>(<span class="hljs-regexp">/\.js$/</span>, plugins.<span class="hljs-title function_">uglify</span>()))
        .<span class="hljs-title function_">pipe</span>(plugins.<span class="hljs-title function_">if</span>(<span class="hljs-regexp">/\.css$/</span>, plugins.<span class="hljs-title function_">cleanCss</span>()))
        .<span class="hljs-title function_">pipe</span>(plugins.<span class="hljs-title function_">if</span>(<span class="hljs-regexp">/\.html$/</span>, plugins.<span class="hljs-title function_">htmlmin</span>({
            <span class="hljs-attr">collapseWhitespace</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 折叠空白字符</span>
            <span class="hljs-attr">minifyCSS</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 自动压缩style里面的css</span>
            <span class="hljs-attr">minifyJS</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 自动压缩script里面的js</span>
            <span class="hljs-comment">// 还有删除注释、空属性等配置</span>
            <span class="hljs-comment">// ...</span>
        })))
        .<span class="hljs-title function_">pipe</span>(<span class="hljs-title function_">dest</span>(<span class="hljs-string">&#x27;dist&#x27;</span>))
}
</code></pre>
<h2>Gulp配置构建任务的类别</h2>
<h4>如何组合任务？</h4>
<ol>
<li>使用parallel/series进行组合任务；</li>
<li>其中parallel是并行执行，series是串行执行</li>
</ol>
<h4>Gulp构建任务的类别</h4>
<p><strong>1. 基础构建：</strong> 只构建css、js、html便于本地测试</p>
<pre><code class="language-js"><span class="hljs-keyword">const</span> compile = <span class="hljs-title function_">parallel</span>(style, script, page) 
</code></pre>
<p><strong>2. 开发模式：</strong> 基础构建 + 启动web服务 + 热更新（图片/字体等文件使用src本地加快构建速度）</p>
<pre><code class="language-js"><span class="hljs-comment">// 2、开发模式：只构建各种代码，启动web服务，图片/字体等文件使用src本地加快构建速度</span>
<span class="hljs-keyword">const</span> develop = <span class="hljs-title function_">series</span>(clean, compile, serve)
</code></pre>
<p><strong>3. 生产模式：</strong> 执行所有任务；包括合并/压缩各种文件，然后将图片/文件也处理了</p>
<pre><code class="language-js"><span class="hljs-keyword">const</span> build = <span class="hljs-title function_">series</span>(
    clean, 
    <span class="hljs-title function_">parallel</span>(
        <span class="hljs-title function_">series</span>(compile, useref), 
        extra, 
        image, 
        font
    )
)
</code></pre>
<h2>其它配置，简化配置、提升自定义程度</h2>
<h4>1、自动加载全部的plugin</h4>
<ul>
<li>功能：避免引入太多常用插件，直接使用plugins替代；例如：需要将sass替换为plugins.sass变量。</li>
<li>依赖：gulp-load-plugins</li>
</ul>
<pre><code class="language-js"><span class="hljs-comment">// const sass = require(&#x27;gulp-sass&#x27;) // npm install gulp-sass --save-dev</span>
<span class="hljs-comment">// ==&gt;</span>
<span class="hljs-comment">// 自动加载全部的plugin；例如sass，使用plugins.sass替换即可</span>
<span class="hljs-keyword">const</span> loadPlugins = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;gulp-load-plugins&#x27;</span>) <span class="hljs-comment">// npm install gulp-load-plugins --save-dev</span>
<span class="hljs-keyword">const</span> plugins = <span class="hljs-title function_">loadPlugins</span>() 
</code></pre>
<p>将原始变量替换为plugins.xxx属性</p>
<pre><code class="language-js">.<span class="hljs-title function_">pipe</span>(<span class="hljs-title function_">sass</span>({ <span class="hljs-attr">outputStyle</span>: <span class="hljs-string">&#x27;expanded&#x27;</span>}))
<span class="hljs-comment">// ==&gt;</span>
.<span class="hljs-title function_">pipe</span>(plugins.<span class="hljs-title function_">sass</span>({ <span class="hljs-attr">outputStyle</span>: <span class="hljs-string">&#x27;expanded&#x27;</span>}))
</code></pre>
<h4>2、模板数据可配置</h4>
<ul>
<li>功能：</li>
</ul>
<blockquote>
<p>1、将模板引擎所需要的数据定义在：pages.config.js，在gulpfile.js中使用默认配置
2、gulpfile.js中的所有路径可以使用变量替换，实现更高的自定义程度</p>
</blockquote>
<ul>
<li>依赖：无</li>
</ul>
<pre><code class="language-js"><span class="hljs-keyword">let</span> config = {
  <span class="hljs-comment">// default config</span>
  <span class="hljs-attr">build</span>: {
    <span class="hljs-attr">src</span>: <span class="hljs-string">&#x27;src&#x27;</span>,
    <span class="hljs-attr">dist</span>: <span class="hljs-string">&#x27;dist&#x27;</span>,
    <span class="hljs-attr">temp</span>: <span class="hljs-string">&#x27;temp&#x27;</span>,
    <span class="hljs-attr">public</span>: <span class="hljs-string">&#x27;public&#x27;</span>,
    <span class="hljs-attr">paths</span>: {
      <span class="hljs-attr">styles</span>: <span class="hljs-string">&#x27;assets/styles/*.scss&#x27;</span>,
      <span class="hljs-attr">scripts</span>: <span class="hljs-string">&#x27;assets/scripts/*.js&#x27;</span>,
      <span class="hljs-attr">pages</span>: <span class="hljs-string">&#x27;*.html&#x27;</span>,
      <span class="hljs-attr">images</span>: <span class="hljs-string">&#x27;assets/images/**&#x27;</span>,
      <span class="hljs-attr">fonts</span>: <span class="hljs-string">&#x27;assets/fonts/**&#x27;</span>
    }
  }
}

<span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">const</span> loadConfig = <span class="hljs-built_in">require</span>(<span class="hljs-string">`<span class="hljs-subst">${cwd}</span>/pages.config.js`</span>)
  config = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>({}, config, loadConfig)
} <span class="hljs-keyword">catch</span> (e) {}
</code></pre>
<ul>
<li>数据文件：pages.config.js</li>
</ul>
<pre><code class="language-js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">build</span>: {
    <span class="hljs-attr">src</span>: <span class="hljs-string">&#x27;src&#x27;</span>,
    <span class="hljs-attr">dist</span>: <span class="hljs-string">&#x27;release&#x27;</span>,
    <span class="hljs-attr">temp</span>: <span class="hljs-string">&#x27;.tmp&#x27;</span>,
    <span class="hljs-attr">public</span>: <span class="hljs-string">&#x27;public&#x27;</span>,
    <span class="hljs-attr">paths</span>: {
      <span class="hljs-attr">styles</span>: <span class="hljs-string">&#x27;assets/styles/*.scss&#x27;</span>,
      <span class="hljs-attr">scripts</span>: <span class="hljs-string">&#x27;assets/scripts/*.js&#x27;</span>,
      <span class="hljs-attr">pages</span>: <span class="hljs-string">&#x27;*.html&#x27;</span>,
      <span class="hljs-attr">images</span>: <span class="hljs-string">&#x27;assets/images/**&#x27;</span>,
      <span class="hljs-attr">fonts</span>: <span class="hljs-string">&#x27;assets/fonts/**&#x27;</span>
    }
  },
  <span class="hljs-attr">data</span>: {
    <span class="hljs-attr">menus</span>: [
      {
        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Home&#x27;</span>,
        <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;aperture&#x27;</span>,
        <span class="hljs-attr">link</span>: <span class="hljs-string">&#x27;index.html&#x27;</span>
      },
      ...
    ],
    <span class="hljs-attr">pkg</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./package.json&#x27;</span>),
    <span class="hljs-attr">date</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()
  }
}
</code></pre>
<h2>配置Npm Scripts，启动构建任务：</h2>
<h4>1、导出任务：在gulpfile.js文件中exports</h4>
<pre><code class="language-js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
    clean,
    build,
    develop
}
</code></pre>
<h4>2、配置scripts：在文件package.json中配置对应任务执行脚本</h4>
<pre><code class="language-js">  <span class="hljs-string">&quot;scripts&quot;</span>: {
    <span class="hljs-string">&quot;clean&quot;</span>: <span class="hljs-string">&quot;gulp clean&quot;</span>,
    <span class="hljs-string">&quot;build&quot;</span>: <span class="hljs-string">&quot;gulp build&quot;</span>,
    <span class="hljs-string">&quot;develop&quot;</span>: <span class="hljs-string">&quot;gulp develop&quot;</span>
  },
</code></pre>
<p><a href="https://kaiwu.lagou.com/">特别鸣谢：拉勾教育前端高薪训练营</a></p>
</div></div></div></div></main></section></section></content><footer class="footer"><div class="el-row el-row"><div class="el-col el-col-10"><div>
          © 2021 Tony Young  
          <a href="https://github.com/ymcdhr" target="_blank">Profile</a>  
          <a href="https://segmentfault.com/u/tonyyoung" target="_blank">Blog</a></div></div><div class="el-col el-col-4"><div style="text-align:center;font-size:12px;"><a href="" target="_blank">托泥羊技术有限公司</a>  
        </div></div><div class="el-col el-col-10"><div style="float:right;"><a href="https://developer.github.com" target="_blank">GitHub-API</a>  
        <a href="https://cn.vuejs.org/" target="_blank">Vue.js</a>  
        <a href="http://element.eleme.io/" target="_blank">Element</a></div></div></div></footer><!----></div>
    <script>window.__INITIAL_STATE__={"data":{"data":{"id":"12","title":"前端工程化5：Gulp最基本配置，10分钟看完就会","user":{"id":1,"username":"ymcdhr","name":"Tony Young","image":{"url":"\u002Fuploads\u002Flogo_521b3eebb2.jpg"}},"content":"## Gulp的基本使用\n\n#### 安装\n```js\n\u003E npm install gulp -g\n```\n\ngulp的配置文件：gulpfile.js\ngulp4.0以后不再推荐使用 gulp.task() ，而是推荐使用 exports 的方式定义任务：\n```js\nexports.foo = done =\u003E{\n\n  done() \u002F\u002F标记任务完成\n}\n```\n\n#### 组合配置\n```js\nconst { series, parallel } = require('gulp')\n\nconst task1 = done =\u003E {\n  setTimeout(() =\u003E {\n    console.log('task1 working~')\n    done()\n  }, 1000)\n}\n\nconst task2 = done =\u003E {\n  setTimeout(() =\u003E {\n    console.log('task2 working~')\n    done()\n  }, 1000)  \n}\n\nconst task3 = done =\u003E {\n  setTimeout(() =\u003E {\n    console.log('task3 working~')\n    done()\n  }, 1000)  \n}\n\n\u002F\u002F 让多个任务按照顺序依次执行\nexports.foo = series(task1, task2, task3)\n\n\u002F\u002F 让多个任务同时执行\nexports.bar = parallel(task1, task2, task3)\n```\n\n#### 异步任务\n```js\nconst fs = require('fs')\n\nexports.callback = done =\u003E {\n  console.log('callback task')\n  done()\n}\n\nexports.callback_error = done =\u003E {\n  console.log('callback task')\n  done(new Error('task failed'))\n}\n\nexports.promise = () =\u003E {\n  console.log('promise task')\n  return Promise.resolve()\n}\n\nexports.promise_error = () =\u003E {\n  console.log('promise task')\n  return Promise.reject(new Error('task failed'))\n}\n\nconst timeout = time =\u003E {\n  return new Promise(resolve =\u003E {\n    setTimeout(resolve, time)\n  })\n}\n\n\u002F\u002F Nodejs版本在8以上可以使用async、await\nexports.async = async () =\u003E {\n  await timeout(1000)\n  console.log('async task')\n}\n\n\u002F\u002F 最常用的一种，读写文件\nexports.stream = () =\u003E {\n  const read = fs.createReadStream('yarn.lock')\n  const write = fs.createWriteStream('a.txt')\n  read.pipe(write) \u002F\u002F 导入文件流\n  return read \u002F\u002F 结束任务\n}\n\n\u002F\u002F exports.stream = done =\u003E {\n\u002F\u002F   const read = fs.createReadStream('yarn.lock')\n\u002F\u002F   const write = fs.createWriteStream('a.txt')\n\u002F\u002F   read.pipe(write)\n\u002F\u002F   read.on('end', () =\u003E { \u002F\u002F 结束任务\n\u002F\u002F     done()\n\u002F\u002F   })\n\u002F\u002F }\n\n```\n\n#### 构建过程核心工作原理\n输入 =\u003E 加工 =\u003E 输出\n\n```js\nconst fs = require('fs')\nconst { Transform } = require('stream')\n\nexports.default = () =\u003E {\n  \u002F\u002F 文件读取流\n  const readStream = fs.createReadStream('normalize.css')\n\n  \u002F\u002F 文件写入流\n  const writeStream = fs.createWriteStream('normalize.min.css')\n\n  \u002F\u002F 文件转换流\n  const transformStream = new Transform({\n    \u002F\u002F 核心转换过程\n    transform: (chunk, encoding, callback) =\u003E {\n      const input = chunk.toString()\n      const output = input.replace(\u002F\\s+\u002Fg, '').replace(\u002F\\\u002F\\*.+?\\*\\\u002F\u002Fg, '')\n      callback(null, output)\n    }\n  })\n\n  return readStream\n    .pipe(transformStream) \u002F\u002F 转换\n    .pipe(writeStream) \u002F\u002F 写入\n}\n\n```\n\n#### 文件操作API\n```js\nconst { src, dest } = require('gulp')\nconst cleanCSS = require('gulp-clean-css')\nconst rename = require('gulp-rename')\n\nexports.default = () =\u003E {\n  return src('src\u002F*.css')\n    .pipe(cleanCSS()) \u002F\u002F 压缩css代码插件\n    .pipe(rename({ extname: '.min.css' })) \u002F\u002F 重命名文件插件\n    .pipe(dest('dist'))\n}\n\n```\n\n\n## Gulp基础配置\n\n#### 准备工作\n\n- 安装gulp工具：npm install gulp -g\n- 创建gulp配置：在项目根目录下新建文件gulpfile.js，用于写gulp的配置文件；\n\n\n#### Task：清空文件\n- 功能：清空构件生产的所有文件\n- 依赖：del\n\n```js\nconst clean = () =\u003E {\n    return del(['dist','temp'])\n}\n```\n\n#### Task：css文件处理，sass文件转换\n- 功能：将sass文件转换成css文件写入指定目录\n- 依赖：gulp-sass\n\n```js\nconst style = () =\u003E {\n    return src('src\u002Fassets\u002Fstyles\u002F*.scss',{ base: 'src'}) \u002F\u002F base指定基础目录，转换后dist目录才会和src保持一样的结构\n        .pipe(plugins.sass({ outputStyle: 'expanded'})) \u002F\u002F { outputStyle: 'expanded'} 参数可以指定结束括号格式化    \n        .pipe(dest('temp'))\n}\n```\n\n#### Task：js文件处理，编译es6+为es5\n- 功能：使用babel插件将js文件里的es6+代码转换为es5\n- 依赖：\n\u003E 1、gulp-babel =\u003E babel工具：转换平台，不作具体的工作\n\u003E 2、@babel\u002Fcore =\u003E babel核心转换模块：完成语言转换工作\n\u003E 3、@babel\u002Fpreset-env =\u003E babel的转换插件：指定babel对应的转换内容；比如env包含es6+全部新特性，将其转换到es5\n\n```js\nconst script = () =\u003E {\n    return src('src\u002Fassets\u002Fscripts\u002F*.js',{ base: 'src'})\n        .pipe(plugins.babel({ \n            presets: ['@babel\u002Fpreset-env'] \u002F\u002F 编译es6，必须传递参数preset-env，否则转换失效(babel配置可以单独放到.babelrc文件)\n        }))\n        .pipe(dest('temp'))\n}\n```\n\n#### Task：html文件的转换，处理swig模板\n- 功能：将指定的swig模板转换为html文件，注意：\n\u003E 1、gulp配置的时候可以将数据以对象的形式传递数据给模板引擎；通常将数据定义在文件中：pages.config.js\n\u003E 2、swig模板的缓存配置可以关闭，防止浏览器在热更新时没有实时刷新\n- 依赖：gulp-swig\n\n```js\nconst page = () =\u003E {\n    return src('src\u002F**\u002F*.html',{ base: 'src'}) \u002F\u002F 其中\u002F**\u002F*.html表示在src目录下任意子目录下的匹配\n        .pipe(plugins.swig({ data: config.data, defaults: { cache: false } }))   \u002F\u002F转换模板页，将data数据传递给模板使用，cache：swig缓存设置，否则热更新时可能不立即生效\n        .pipe(dest('temp'))\n}\n```\n\n#### Task：图片压缩，减少图片体积\n- 功能：压缩图片体积\n- 依赖：gulp-imagemin\n\n```js\nconst image = () =\u003E {\n    return src('src\u002Fassets\u002Fimages\u002F**',{ base: 'src'})\n        .pipe(plugins.imagemin())\n        .pipe(dest('dist'))\n}\n```\n\n\n#### Task：字体文件压缩，减少字体文件体积\n- 功能：压缩字体体积\n- 依赖：gulp-imagemin\n\n```js\nconst font = () =\u003E {\n    return src('src\u002Fassets\u002Ffonts\u002F**', { base: 'src' })\n      .pipe(plugins.imagemin())\n      .pipe(dest('dist'))\n}\n```\n\n#### Task：其它文件移动，例如视频\n- 功能：移动其余所有文件到指定目录\n- 依赖：无\n\n```js\nconst extra = () =\u003E {\n    return src('public\u002F**', { base: 'public' })\n        .pipe(dest('dist'))\n}\n```\n\n\n\n## Gulp的本地服务\u002F热更新\u002F文件合并与压缩\n#### Task：本地Web服务与热更新\n- 功能1：本地Web服务\n\u003E 1、使用插件browser-sync来启动本地Web服务，并支持一些配置（具体参考示例代码）\n\u003E 2、重要配置：根路径baseDir，配置后gulp从指定的路径按顺序查找\n\u003E 3、重要配置：路径查找路由routes，例如：\u002Fnode_modules映射到node_modules\n\n- 功能2：浏览器的热更新\n\u003E 在browser-sync插件的配置中使用files: 'temp\u002F**'监视目录下所有文件\n\n- 功能3：源文件的热更新\n\u003E 1、监视源文件，如果源文件修改后立即重新构建\n\u003E 2、开发模式下：监视的范围不包括图片、字体和其它文件，将他们的访问路径指定为src路径下可提升构建效率\n\n- 依赖：browser-sync\n\n```js\nconst serve = () =\u003E {\n    \u002F\u002F 监视src文件，重新构建代码\n    watch('src\u002Fassets\u002Fstyles\u002F*.scss', style)\n    watch('src\u002Fassets\u002Fscripts\u002F*.js', script)\n    watch('src\u002F*.html', page)\n\n    \u002F\u002F 图片、字体在开发阶段没有必要重新执行构建任务；所以让gulp从源文件src、public里面查找  \n    \u002F\u002F 图片、字体等文件发生变化后，bs.reload 更新浏览器\n    watch([\n        'src\u002Fassets\u002Fimages\u002F**',\n        'src\u002Fassets\u002Ffonts\u002F**',\n        'public\u002F**'\n    ], bs.reload)\n    \n    \u002F\u002F 配置web服务器，监视dist\n    bs.init({\n        notify: false, \u002F\u002F 右上角提示\n        port: 2080, \u002F\u002F 服务的端口，默认300\n        \u002F\u002F open: false, \u002F\u002F 自动打开浏览器\n        files: 'temp\u002F**', \u002F\u002F 热更新，dist下的所有文件变化时，同步更新浏览器\n        server: {\n          \u002F\u002F服务启动时，首先访问dist根目录；查询路径：dist=\u003Esrc=\u003Epublic\n          \u002F\u002F因为图片字体等文件没必要热更新重新构建（减少构建时间），所以让gulp从源文件src、public里面查找  \n          baseDir: ['temp', 'src', 'public'], \n          routes: {\u002F\u002F 路径查找路由\n            '\u002Fnode_modules': 'node_modules' \u002F\u002F优先级高于baseDir,先查找node_modules目录\n          }\n        }\n    })\n}\n```\n\n#### Task：文件合并与压缩混淆\n- 功能1：文件合并\n\u003E useref插件查询指定路径，然后将对应的文件合并\n- 功能2：文件压缩\n\u003E 1、压缩js\n\u003E 2、压缩css\n\u003E 3、压缩html\n- 依赖：\n\u003E 1、gulp-useref =\u003E 查询路径，合并文件\n\u003E 2、gulp-if =\u003E 判断条件插件\n\u003E 3、gulp-uglify =\u003E 压缩js\n\u003E 4、gulp-clean-css=\u003E 压缩css\n\u003E 5、gulp-htmlmin =\u003E 压缩html\n\n```js\nconst useref = () =\u003E {\n    return src('temp\u002F*.html', { base: 'temp' })\n        .pipe(plugins.useref({ searchPath: ['temp', '.'] })) \u002F\u002F查询路径：dist、.根目录下（node_modules） \n        \u002F\u002F html js css压缩代码\n        .pipe(plugins.if(\u002F\\.js$\u002F, plugins.uglify()))\n        .pipe(plugins.if(\u002F\\.css$\u002F, plugins.cleanCss()))\n        .pipe(plugins.if(\u002F\\.html$\u002F, plugins.htmlmin({\n            collapseWhitespace: true, \u002F\u002F 折叠空白字符\n            minifyCSS: true, \u002F\u002F 自动压缩style里面的css\n            minifyJS: true \u002F\u002F 自动压缩script里面的js\n            \u002F\u002F 还有删除注释、空属性等配置\n            \u002F\u002F ...\n        })))\n        .pipe(dest('dist'))\n}\n```\n\n## Gulp配置构建任务的类别\n#### 如何组合任务？\n1. 使用parallel\u002Fseries进行组合任务；\n2. 其中parallel是并行执行，series是串行执行\n\n#### Gulp构建任务的类别\n **1. 基础构建：** 只构建css、js、html便于本地测试\n```js\nconst compile = parallel(style, script, page) \n```\n\n **2. 开发模式：** 基础构建 + 启动web服务 + 热更新（图片\u002F字体等文件使用src本地加快构建速度）\n```js\n\u002F\u002F 2、开发模式：只构建各种代码，启动web服务，图片\u002F字体等文件使用src本地加快构建速度\nconst develop = series(clean, compile, serve)\n```\n\n **3. 生产模式：** 执行所有任务；包括合并\u002F压缩各种文件，然后将图片\u002F文件也处理了\n```js\nconst build = series(\n    clean, \n    parallel(\n        series(compile, useref), \n        extra, \n        image, \n        font\n    )\n)\n```\n\n## 其它配置，简化配置、提升自定义程度\n#### 1、自动加载全部的plugin\n- 功能：避免引入太多常用插件，直接使用plugins替代；例如：需要将sass替换为plugins.sass变量。\n- 依赖：gulp-load-plugins\n\n```js\n\u002F\u002F const sass = require('gulp-sass') \u002F\u002F npm install gulp-sass --save-dev\n\u002F\u002F ==\u003E\n\u002F\u002F 自动加载全部的plugin；例如sass，使用plugins.sass替换即可\nconst loadPlugins = require('gulp-load-plugins') \u002F\u002F npm install gulp-load-plugins --save-dev\nconst plugins = loadPlugins() \n```\n\n将原始变量替换为plugins.xxx属性\n```js\n.pipe(sass({ outputStyle: 'expanded'}))\n\u002F\u002F ==\u003E\n.pipe(plugins.sass({ outputStyle: 'expanded'}))\n```\n\n#### 2、模板数据可配置\n- 功能：\n\u003E 1、将模板引擎所需要的数据定义在：pages.config.js，在gulpfile.js中使用默认配置\n\u003E 2、gulpfile.js中的所有路径可以使用变量替换，实现更高的自定义程度\n- 依赖：无\n\n```js\nlet config = {\n  \u002F\u002F default config\n  build: {\n    src: 'src',\n    dist: 'dist',\n    temp: 'temp',\n    public: 'public',\n    paths: {\n      styles: 'assets\u002Fstyles\u002F*.scss',\n      scripts: 'assets\u002Fscripts\u002F*.js',\n      pages: '*.html',\n      images: 'assets\u002Fimages\u002F**',\n      fonts: 'assets\u002Ffonts\u002F**'\n    }\n  }\n}\n\ntry {\n  const loadConfig = require(`${cwd}\u002Fpages.config.js`)\n  config = Object.assign({}, config, loadConfig)\n} catch (e) {}\n```\n\n- 数据文件：pages.config.js\n\n```js\nmodule.exports = {\n  build: {\n    src: 'src',\n    dist: 'release',\n    temp: '.tmp',\n    public: 'public',\n    paths: {\n      styles: 'assets\u002Fstyles\u002F*.scss',\n      scripts: 'assets\u002Fscripts\u002F*.js',\n      pages: '*.html',\n      images: 'assets\u002Fimages\u002F**',\n      fonts: 'assets\u002Ffonts\u002F**'\n    }\n  },\n  data: {\n    menus: [\n      {\n        name: 'Home',\n        icon: 'aperture',\n        link: 'index.html'\n      },\n      ...\n    ],\n    pkg: require('.\u002Fpackage.json'),\n    date: new Date()\n  }\n}\n```\n\n\n\n\n\n\n\n## 配置Npm Scripts，启动构建任务：\n\n#### 1、导出任务：在gulpfile.js文件中exports \n```js\nmodule.exports = {\n    clean,\n    build,\n    develop\n}\n```\n#### 2、配置scripts：在文件package.json中配置对应任务执行脚本\n```js\n  \"scripts\": {\n    \"clean\": \"gulp clean\",\n    \"build\": \"gulp build\",\n    \"develop\": \"gulp develop\"\n  },\n```\n\n[特别鸣谢：拉勾教育前端高薪训练营](https:\u002F\u002Fkaiwu.lagou.com\u002F)\n\n\n","published_at":"2021-07-11T18:21:27.186Z","updated_at":"2021-07-12T07:15:26.316Z"}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.aa04e74c.js" defer></script><script src="/assets/js/page--src-templates-blog-vue.a3da5a2e.js" defer></script>
  </body>
</html>
